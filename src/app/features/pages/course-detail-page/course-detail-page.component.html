<div class="container">
    <!-- <div class="list-container"> -->
        <h4 class="mb-0">All Chapters</h4>
        <!-- <ul class="unordered-list">
          <ng-container *ngFor="let chapter of allChapters; let i = index">
            <li class="list-item">
              <span
                ><b><h5 class="m-0">{{ chapter.name }}</h5></b></span
              >
              <div class="button-container">
                <i class="fas fa-pencil-alt" *ngIf="checkRole('admin')" [routerLink]="['/dash/edit-course', chapter.id]"></i>
                <i class="far fa-trash-alt trash" *ngIf="checkRole('admin')" (click)="onDelete(chapter.id)"></i>
                <i class="fab fa-youtube" (click)="openPlayer(chapter.video)"></i>
                <i class="fas fa-file-pdf" (click)="open(content, chapter)"></i>
                <img src="assets/icons/questions.png" alt="Quiz image" width="20" [routerLink]="['/dash/user-testSeries', chapter.testSeriesId]" >
              </div>
            </li>
          </ng-container>
        </ul> -->

        
      <!-- </div> -->

      <div class="accordion mt-5" id="accordionExample">
        <div
          class="accordion-item"
          *ngFor="let item of allChapters; let i = index"
        >
          <h2 class="accordion-header" [id]="'heading' + i">
            <div
              class="accordion-button"
              
              data-bs-toggle="collapse"
              [attr.data-bs-target]="'#collapse' + i"
              [attr.aria-expanded]="i === 0 ? 'true' : 'false'"
              [attr.aria-controls]="'collapse' + i"
            >
              <div class="w-100"> <span class="title">{{ item.name }} </span></div> <!--<span *ngIf="checkRole('admin')" class="badge" [ngClass]="item && item.isActive ? 'badge-success': 'badge-secondary'">{{item && item.isActive ? "Active": "Inactive"}}&nbsp;&nbsp;</span> -->
              <div class="button-container w-100">
                <i class="fas fa-pencil-alt" *ngIf="checkRole('admin') || checkRole('super admin')" [routerLink]="['/dash/edit-course', item.id]"></i>
                <i class="far fa-trash-alt trash" *ngIf="checkRole('admin') || checkRole('super admin')" (click)="onDelete(item.id)"></i>
                <img *ngIf="(checkRole('admin') || checkRole('super admin')) && item.isOfflineTest" src="assets/icons/answer.png" alt="answer_sheet" width="25"(click)="openSumitedTestList(testList, item.id)"  ngbTooltip="Submited answer sheet" >
                
                <i *ngIf="item.video" class="fab fa-youtube" (click)="openPlayer(item.video)"></i>
                <i *ngIf="item.courseMaterials.length > 0" class="fas fa-file-pdf" (click)="open(content, item)"></i>
                @if((checkRole('user')) && item.testDetails?.status !== 'Completed') {
                  @if(item.isOfflineTest ) {
                    <img src="assets/icons/start.png" alt="Quiz image" width="25" (click)="openTest(offlineTest, item)" ngbTooltip="Start offline test" >
                  } @else {
                    <!-- <img *ngIf="item.testId !== null" src="assets/icons/testing.png" alt="Quiz image" width="25" [routerLink]="['/dash/test', item.testId, item.parentId]" ngbTooltip="Start online test" > -->
                    <i *ngIf="item.testId !== null" class="fas fa-list-check" (click)="openInstuctionModel(instruction, item)"  ngbTooltip="Start online test"></i> <!--[routerLink]="['/dash/test', item.testId, item.parentId]"-->
                     
                  }

                }
                <i *ngIf="checkRole('user') && item.testDetails?.status === 'Completed'" class="fas fa-chart-bar" (click)="seeResult(Result, item)" ngbTooltip="Result"></i>
                <!-- <img  *ngIf="checkRole('user') && item.testDetails?.status === 'Completed'" src="assets/icons/analysis.png" alt="Quiz image" width="25" (click)="seeResult(Result, item)" > -->
              </div>
          </div>
          </h2>
          <div
            [id]="'collapse' + i"
            class="accordion-collapse collapse"
            [ngClass]="{ show: i === 0 }"
            [attr.aria-labelledby]="'heading' + i"
            data-bs-parent="#accordionExample"
          >
            <div class="accordion-body">
              <p><strong>Description:</strong></p>  <div class="ql-editor" [innerHTML]="sanitizer.bypassSecurityTrustHtml(item.description)"></div> <!--{{ item.description }}-->
              <!-- <p><strong>Video:</strong> <a [href]="item.video" target="_blank">View Video</a></p>
              <p><strong>Test Series ID:</strong> {{ item.testSeriesId }}</p>
      
              <div *ngIf="item.courseMaterials?.length">
                <strong>Course Materials:</strong>
                <ul>
                  <li *ngFor="let material of item.courseMaterials">
                    <a [href]="material.pdf" target="_blank">Download PDF</a>
                  </li>
                </ul>
              </div>
      
              <p *ngIf="!item.courseMaterials?.length">No course materials available.</p> -->
            </div>
          </div>
        </div>
      </div>
      

      <!-- <div class="accordion mt-5" id="accordionExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
              Accordion Item #1
            </button>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <strong>This is the first item's accordion body.</strong> It is shown by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
              Accordion Item #2
            </button>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <strong>This is the second item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
              Accordion Item #3
            </button>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <strong>This is the third item's accordion body.</strong> It is hidden by default, until the collapse plugin adds the appropriate classes that we use to style each element. These classes control the overall appearance, as well as the showing and hiding via CSS transitions. You can modify any of this with custom CSS or overriding our default variables. It's also worth noting that just about any HTML can go within the <code>.accordion-body</code>, though the transition does limit overflow.
            </div>
          </div>
        </div>
      </div> -->
</div>



<ng-template #content let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Course Material</h4>
		<button type="button" class="btn-close" aria-label="Close" (click)="showPdf=false;modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body">
        @if(!showPdf) {
            <div class="list-container">
            
                <ul class="unordered-list">
                  <ng-container *ngFor="let mateirial of courseMaterial.courseMaterials; let i = index">
                    <li class="list-item">
                      <span
                        ><b>{{ extractFilename(mateirial.pdf) }}</b></span
                      >
                      <div class="button-container">
                        <button class="custom-button edit-btn" (click)="pdfLink = mateirial.pdf ;showPdf = true; " >View</button>
                          <button class="custom-button delete-btn" (click)="downloadFile(mateirial.pdf , courseMaterial.name +'-'+'material'+ i+1)" >Download</button>
                      </div>
                    </li>
                  </ng-container>
                </ul>
            </div>
        } @else {
            <pdf-viewer
            id="outerContainer"
            [src]="staticBaseUrl+pdfLink"
            [rotation]="0"
            [original-size]="false"
            [show-all]="true"
            [fit-to-page]="false"
            [zoom]="1"
            [zoom-scale]="'page-width'"
            [stick-to-page]="false"
            [render-text]="true"
            [external-link-target]="'blank'"
            [autoresize]="true"
            [show-borders]="false"
            style="width: 100%; height: 400px;"
           
          ></pdf-viewer>  
          <!-- (after-load-complete)="afterLoadComplete($event)" 
          (pagechanging)="onPageChange($event, editorial.id)"  -->
        }
		
	</div>
	<div class="modal-footer" *ngIf="showPdf">
		<button type="button" class="custom-button edit-btn" (click)="pdfLink = '';showPdf = false">Back</button>
	</div>
</ng-template>


<ng-template #offlineTest let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Offline test</h4>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body">

    @if(allSubmittedAnswerSheet.length > 0) {
      @if(!showPdf) {
        <div class="list-container">
        
            <ul class="unordered-list">
              <!-- <ng-container > -->
                <!-- *ngFor="let paper of allSubmittedAnswerSheet; let i = index" -->
                @for(paper of allSubmittedAnswerSheet; track paper.id) {
                  <li class="list-item">
                    <span
                      ><b>{{ paper.userName }}</b></span
                    >
                    <div class="button-container">
                      <button class="custom-button edit-btn" (click)="pdfLink = paper.sheet ;showPdf = true;" >View</button>
                        <button class="custom-button delete-btn" (click)="downloadFile(paper.sheet , paper.userName)" >Download</button>
                    </div>
                  </li>
                } @empty {
                  <p>No data found for the corresponding chapter</p>
                }
               
              <!-- </ng-container> -->
            </ul>
        </div>
      } @else {
        <pdf-viewer
        id="outerContainer"
        [src]="staticBaseUrl+pdfLink"
        [rotation]="0"
        [original-size]="false"
        [show-all]="true"
        [fit-to-page]="false"
        [zoom]="1"
        [zoom-scale]="'page-width'"
        [stick-to-page]="false"
        [render-text]="true"
        [external-link-target]="'blank'"
        [autoresize]="true"
        [show-borders]="false"
        style="width: 100%; height: 400px;"
       
      ></pdf-viewer>  
      <!-- (after-load-complete)="afterLoadComplete($event)" 
      (pagechanging)="onPageChange($event, editorial.id)"  -->
      }
    } @else {
      <header class="rounded" *ngIf="courseDetails.testDetails !== null">
        <div class="difficulty" aria-label="Difficulty Level">
            <h1>{{courseDetails.testDetails && courseDetails.testDetails.title | uppercase}}     </h1>
         
             <div class="test-timer">
                <i class="far fa-clock"></i> Time: {{ remainingTime }}
              </div>
    
        </div>
      </header>
  
      <div class="mt-3">
        <label class="form-label" for="customFile">Please upload answer sheet</label> 
        <input type="file" class="form-control" aria-describedby="fileHelp" accept=".pdf" id="customFile" (change)="onFileSelected($event)"/>
        <!-- <small id="fileHelp" class="form-text text-muted">Upload image files only (JPG, JPEG, PNG)</small> -->
        <!-- Display List of Uploaded Files -->
        <div *ngIf="uploadedFiles.length > 0" class="mt-3">
          <h5>Uploaded Files:</h5>
          <ul class="list-group">
            <li *ngFor="let file of uploadedFiles; let i = index" class="list-group-item d-flex justify-content-between align-items-center">
              {{ file.name }}
              <button type="button" class="btn btn-danger btn-sm" (click)="deleteFile(i)">
                Delete
              </button>
            </li>
          </ul>
        </div>
  
      </div>
    }

   

    
		
	</div>
  <div class="modal-footer"  *ngIf="showPdf && allSubmittedAnswerSheet.length > 0" >
		<button type="button" class="custom-button edit-btn" (click)="pdfLink = '';showPdf = false">Back</button>
	</div>
	<div class="modal-footer" *ngIf="allSubmittedAnswerSheet.length == 0"  >
		<button type="button" class="custom-button edit-btn" (click)="uploadTestPaper()">Upload</button>
		<button type="button" class="custom-button delete-btn" (click)="cancelTest()">Cancel</button>
	</div>
</ng-template>



<ng-template #testList let-modal>
	<div class="modal-header">
		<h4 class="modal-title" id="modal-basic-title">Submiited Papers</h4>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body">
    @if(!showPdf) {
            <div class="list-container">
            
                <ul class="unordered-list">
                  <!-- <ng-container > -->
                    <!-- *ngFor="let paper of allSubmittedAnswerSheet; let i = index" -->
                    @for(paper of allSubmittedAnswerSheet; track paper.id) {
                      <li class="list-item">
                        <span
                          ><b>{{ paper.userName }}</b></span
                        >
                        <div class="button-container">
                          <button class="custom-button edit-btn" (click)="pdfLink = paper.sheet ;showPdf = true;" >View</button>
                            <button class="custom-button delete-btn" (click)="downloadFile(paper.sheet , paper.userName)" >Download</button>
                        </div>
                      </li>
                    } @empty {
                      <p>No data found for the corresponding chapter</p>
                    }
                   
                  <!-- </ng-container> -->
                </ul>
            </div>
          } @else {
            <pdf-viewer
            id="outerContainer"
            [src]="staticBaseUrl+pdfLink"
            [rotation]="0"
            [original-size]="false"
            [show-all]="true"
            [fit-to-page]="false"
            [zoom]="1"
            [zoom-scale]="'page-width'"
            [stick-to-page]="false"
            [render-text]="true"
            [external-link-target]="'blank'"
            [autoresize]="true"
            [show-borders]="false"
            style="width: 100%; height: 400px;"
           
          ></pdf-viewer>  
          <!-- (after-load-complete)="afterLoadComplete($event)" 
          (pagechanging)="onPageChange($event, editorial.id)"  -->
        }
		
	</div>
	<div class="modal-footer"  *ngIf="showPdf" >
		<button type="button" class="custom-button edit-btn" (click)="pdfLink = '';showPdf = false">Back</button>
	</div>
</ng-template>



<ng-template #Result let-modal>
  <div class="custom-modal-container">
    <div class="modal-body p-0">
      <div class="test-result-card">
        <div class="test-card-header d-flex justify-content-between">
          <div class="w-100">
            <h4 class="mb-0">Test Result</h4>
          </div>
          <button
            type="button"
            class="btn-close"
            aria-label="Close"
            (click)="modal.dismiss('Cross click')"
          ></button>
        </div>
        <div class="test-card-body">
          <ul>
            <li>
              Total Questions:
              <span>{{
                testResultDetails && testResultDetails.totalQuestions
              }}</span>
            </li>
            <li>
              Answered Questions:
              <span>{{
                testResultDetails && testResultDetails.answeredQuestions
              }}</span>
            </li>
            <li>
              Unanswered Questions:
              <span>{{
                testResultDetails && testResultDetails.unansweredQuestions
              }}</span>
            </li>
            <p class="border"></p>

            <li>
              
             <ul>
              <li class="visibility-hidden"><b>Answer Type</b></li>
              <li>Right Answered:</li>
              <li>Wrong Answered:</li>
              
             </ul>
             <ul>
              <li><b>Count</b></li>
              <li>
                <span>{{
                  testResultDetails && testResultDetails.rightAnswered
                }}</span>
              </li>
              <li>
                <span>{{
                  testResultDetails && testResultDetails.wrongAnswered
                }}</span>
              </li>
              
             </ul>
             <ul>
              <li><b>Marks</b></li>
              <li>
                <span>{{
                  ((testResultDetails && testResultDetails.marksObtained) + (testResultDetails && testResultDetails.negativeMarksObtained)).toFixed(2)
                }}</span>
              </li> 
              <li>
               <span>{{
                  -(testResultDetails && testResultDetails.negativeMarksObtained.toFixed(2))
                }}</span>
              </li> 
              
             </ul>
           </li>
           <p class="border"></p>
           <li class="mb-0">
            <ul>
              <li>Total Marks:</li>
            </ul>
            <ul class="px-5">
              <li>
                <span>{{
                  testResultDetails && testResultDetails.totalMarks
                }}</span>
              </li>

            </ul>  
            <ul class="px-2">
              <li>
                <span *ngIf="testResultDetails">{{
                  (testResultDetails && testResultDetails.marksObtained).toFixed(2)
                }}</span>
              </li>

            </ul>
            
           </li>

            <!--<li>
               Right Answered:
              <span>{{
                testResultDetails && testResultDetails.rightAnswered
              }}</span>
            </li> -->


            <!-- <li>
              Wrong Answered:
              <span>{{
                testResultDetails && testResultDetails.wrongAnswered
              }}</span>
            </li>
           
            <li>
              Total Marks:
              <span>{{
                testResultDetails && testResultDetails.totalMarks
              }}</span>
            </li> -->
            
            <!-- <p class="border"></p> -->
            <li>
              Evaluation Score:
              <span
                >{{
                  testResultDetails &&
                    testResultDetails.evaluationScore.toFixed(2)
                }}%</span
              >
            </li>

            <li>
              Negative Marking:
              <span
                >{{
                - ((testResultDetails && testResultDetails.negativeMarksObtained)/(testResultDetails && testResultDetails.wrongAnswered)).toFixed(2)
                }}</span
              >
            </li>

          </ul>
        </div>
        <div class="test-card-footer">
          <p>
            <strong>Test:</strong>
            {{ testResultDetails && testResultDetails.testTitle }}
          </p>
          <p>
            <strong>User:</strong>
            {{ testResultDetails && testResultDetails.userName }}
          </p>
          <p class="d-flex align-items-center justify-content-between">
            <span>
            <strong>Subitted:</strong>
            {{
              testResultDetails && testResultDetails.createdAt
                | date : "d MMM, y"
            }}

            </span>
            <button  type="button" class="btn btn-outline-primary" (click)="goToAnalysis(testResultDetails && testResultDetails.testId)">See Analysis</button>
          </p>
        </div>
        <!-- <div class="button-wrapper">
          
          
        </div> -->
      </div>
    </div>
  </div>
</ng-template> 



<ng-template #instruction let-modal>
	<div class="modal-header">
		<h4 class="modal-title mb-0" id="modal-basic-title">Paper Instructions: Online & Offline</h4>
		
    <button
    type="button"
    class="btn-close"
    aria-label="Close"
    (click)="modal.dismiss('Cross click')"
  ></button>
    
	</div>
	<div class="modal-body">
		<body style="font-family: 'Arial', sans-serif; margin: 0; padding: 0; background-color: #f9f9f9; color: #333;">

      
    
      <div style="background-color: white; padding: 20px; border-radius: 8px;">
        
        <div style="margin-bottom: 40px; padding-bottom: 10px; border-bottom: 2px solid #ececec;">
          <h2 style="font-size: 20px; font-weight: bold; margin-bottom: 15px; color: #1A1F35;">Online Paper Instructions</h2>
          <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
            The online test provides an easy-to-use platform for conducting exams. To ensure a smooth experience, please follow these guidelines:
          </p>
          <ul style="padding-left: 20px; margin-bottom: 20px;">
            <li style="margin-bottom: 10px; font-size: 16px;">Ensure a stable internet connection throughout the exam.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Preferably use a desktop or laptop for the best experience. Avoid using mobile devices.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Log in to your account before the exam begins to avoid delays.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Be aware of the start time and join the exam promptly to avoid any disruptions.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Review the instructions and exam paper before starting.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Use the built-in timer to keep track of the remaining exam time.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">If you experience technical difficulties, immediately contact the support team for assistance.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Your answers will be saved automatically and submitted once the exam is completed.</li>
          </ul>
        </div>
    
        <div style="padding-bottom: 10px;">
          <h2 style="font-size: 20px; font-weight: bold; margin-bottom: 15px; color: #1A1F35;">Offline Paper Instructions</h2>
          <p style="font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
            For offline exams, the test will be conducted in a traditional format on paper. Follow the guidelines below:
          </p>
          <ul style="padding-left: 20px; margin-bottom: 20px;">
            <li style="margin-bottom: 10px; font-size: 16px;">Ensure you have a pen/pencil and all necessary stationary before starting.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Write your name, roll number, and other required details on the first page.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Read all instructions carefully before starting the exam.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Answer all questions in the provided spaces on the test paper.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Do not write outside the designated answer spaces.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Ensure your handwriting is legible and clear.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Once the exam is completed, submit your paper to the invigilator.</li>
            <li style="margin-bottom: 10px; font-size: 16px;">Double-check your paper for any missed questions before submission.</li>
          </ul>
        </div>
    
      </div>
    
      <!-- <footer style="background-color: #4e54c8; color: white; text-align: center; padding: 15px 0; font-size: 14px;">
        © 2024 Insight Into | All Rights Reserved
      </footer> -->
    
    </body>
	</div>
	<div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary"  (click)="modal.dismiss('Cross click')">Cancel</button>
    <!-- <a href="assets/AnswerSheet.jpeg" download class="disabled-link" >
      <button class="btn btn-outline-primary" disabled>Get answer sheet</button>
    </a> -->
		<button type="button" class="btn btn-outline-primary" [routerLink]="['/dash/test', selectedTest.testId, selectedTest.parentId]" (click)="modal.dismiss('Cross click')" >Attempt Online</button> <!--(click)="onlineStart(selectedTest)"-->
		<!-- <button type="button" class="btn btn-outline-primary" disabled >Attempt Offline</button> (click)="offlineStart(selectedTest)" -->
	</div>
</ng-template>